<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>anchen website</title>
		<link rel="stylesheet" href="http://yui.yahooapis.com/3.5.0/build/cssreset/reset-min.css">
		<link rel="short icon" type="image/x-icon" href="images/icon.ico">
		<link rel="stylesheet" type="text/css" href="style/article.css">
		<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
		<!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	</head>
	<body>
		<div class="wrap">
			<h1>js 全局/局部变量和闭包的探讨</h1>
			<p>做个人网站时遇到一个问题：</p>
	<pre>
	<code>
	window.onload=function(){
    	 var home=document.getElementById('home');
    	 var aUl=home.getElementsByTagName('ul')[0];
     	var ali=aUl.getElementsByTagName('li');
     	var oDiv=home.getElementsByTagName('div');
     	var timer=null;
     	var i=0;
     	 for(i=0;i<3;i++){
    
          	ali[i].onmouseover=function(){
              	 clearInterval(timer);
              	 setTimeout(function(){
                  	  oDiv[i].style.display='block';//错误：无效

             	  },300);
         	 };
    	 };

	}


	</code>
	</pre>

			<p>然后开始仔细审视全局变量和局部变量。</p>
			<p>  以上错误的原因就是：for循环没有放在一个方法内，所以i这个变量就被认为是全局变量，最后的执行结果相当于直接i=3。</p>
			<p> 有很多很细小的地方会忽略，比如如果一个变量在function内没有var声明，那它将会默认是一个全局变量，这是一种隐式声明变量的方法。</p>
	<pre>
	<code>
	var n=1992;

	function ss(){
		alert(n);
	}

	ss(); //1992
	</code>
	</pre>
			<p>另一方面，在函数外部自然无法读取函数内的局部变量。</p>
	<pre>
	<code>
	function ss(){
		var n=1992;
	}

	alert(n); // error
	</code>
	</pre>
			<P>顺便引申另一个小问题：</P>
			<p> var 定义函数，必须先声明后调用，这涉及到局部变量的问题。而无var,直接function，则顺序无要求。</p>
			<p>接着可以继续引申一个重要的知识点——闭包。</p>
			<p>一般来说外部无法调用局部变量，但有一种方法可以，就是构成闭包。</p>
	<pre>
	<code>
	function ss(){

		n=1992;

	function ss1(){
		alert(n); // 1992
	}

	}
	</code>
	</pre>
			<p>由上可见内部函数是可以调用外部变量的，如果我们把内部函数当成外部的返回值，就可以让外部调用内部变量了。</p>
	<pre>
	<code>
	function ss(){

		n=1992;

		function ss1(){//闭包
			alert(n); // 1992
		}
		return ss1()；//返回值
		}

	var result=ss();

	result();//1992
	</code>
	</pre>
		<p>闭包的用途有：</p>
		<p>1.可以读取函数内部的变量；</p>
		<p>2.让这些变量的值始终保存在内存中。</p>
			<div class="gonext line">
				<p><a href="index.html" title="index">返回首页</a></p>
			</div>
		</div>
		<div id="backToTop">
			<a href="javascript:;" onfocus="this.blur();" class="backToTop_a png"></a>
		</div>
		<script >
		$(function(){
	$('#backToTop').live('click',function(){
		var _this=$(this);
		$('html ,body').animate({scrollTop:0},500,function(){
			_this.hide();
		});
	});
	$(window).scroll(function(){
		var htmlTop=$(document).scrollTop();
		if(htmlTop>0){
			$('#backToTop').show();
		}else{
			$('#backToTop').hide();
		}
	});
});
		</script>
	</body>
</html>